{"ast":null,"code":"import _slicedToArray from\"D:\\\\Facultate\\\\AN3 SEM 2\\\\EGIOC\\\\ping-pong-r3f-usecannon-forked\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";// react-three-fiber is a way to express threejs declaratively: https://github.com/react-spring/react-three-fiber\nimport{Canvas,useFrame,useLoader}from\"react-three-fiber\";// use-cannon is a hook around the cannon.js physics library: https://github.com/react-spring/use-cannon\nimport{Physics,useSphere,useBox,usePlane}from\"use-cannon\";// zustand is a minimal state-manager: https://github.com/react-spring/zustand\nimport create from\"zustand\";import*as THREE from\"three\";import{GLTFLoader}from\"three/examples/jsm/loaders/GLTFLoader\";import React,{Suspense,useRef,useCallback}from\"react\";import lerp from\"lerp\";import clamp from\"lodash-es/clamp\";import Text from\"./Text\";import pingSound from\"./resources/ping.mp3\";import earthImg from\"./resources/cross.jpg\";// Create a store ...\nvar ping=new Audio(pingSound);var _create=create(function(set){return{count:0,welcome:true,api:{pong:function pong(velocity){ping.currentTime=0;ping.volume=clamp(velocity/20,0,1);ping.play();if(velocity>4)set(function(state){return{count:state.count+1};});},reset:function reset(welcome){return set(function(state){return{welcome:welcome,count:welcome?state.count:0};});}}};}),_create2=_slicedToArray(_create,1),useStore=_create2[0];// The paddle was made in blender and auto-converted to JSX by https://github.com/react-spring/gltfjsx\nfunction Paddle(){// Load the gltf file\nvar _useLoader=useLoader(GLTFLoader,\"/pingpong.glb\"),nodes=_useLoader.nodes,materials=_useLoader.materials;// Fetch some reactive state\nvar _useStore=useStore(function(state){return state.api;}),pong=_useStore.pong;var welcome=useStore(function(state){return state.welcome;});var count=useStore(function(state){return state.count;});var model=useRef();// Make it a physical object that adheres to gravitation and impact\nvar _useBox=useBox(function(){return{type:\"Kinematic\",args:[3.4,1,3.5],onCollide:function onCollide(e){return pong(e.contact.impactVelocity);}};}),_useBox2=_slicedToArray(_useBox,2),ref=_useBox2[0],api=_useBox2[1];// use-frame allows the component to subscribe to the render-loop for frame-based actions\nvar values=useRef([0,0]);useFrame(function(state){// The paddle is kinematic (not subject to gravitation), we move it with the api returned by useBox\nvalues.current[0]=lerp(values.current[0],state.mouse.x*Math.PI/5,0.2);values.current[1]=lerp(values.current[1],state.mouse.x*Math.PI/5,0.2);api.position.set(state.mouse.x*10,state.mouse.y*5,0);api.rotation.set(0,0,values.current[1]);// Left/right mouse movement rotates it a liitle for effect only\nmodel.current.rotation.x=lerp(model.current.rotation.x,welcome?Math.PI/2:0,0.2);model.current.rotation.y=values.current[0];});return/*#__PURE__*/React.createElement(\"mesh\",{ref:ref,dispose:null},/*#__PURE__*/React.createElement(\"group\",{ref:model,position:[-0.05,0.37,0.3],scale:[0.15,0.15,0.15]},/*#__PURE__*/React.createElement(Text,{rotation:[-Math.PI/2,0,0],position:[0,1,2],size:1,children:count.toString()}),/*#__PURE__*/React.createElement(\"group\",{rotation:[1.88,-0.35,2.32],scale:[2.97,2.97,2.97]},/*#__PURE__*/React.createElement(\"primitive\",{object:nodes.Bone}),/*#__PURE__*/React.createElement(\"primitive\",{object:nodes.Bone003}),/*#__PURE__*/React.createElement(\"primitive\",{object:nodes.Bone006}),/*#__PURE__*/React.createElement(\"primitive\",{object:nodes.Bone010}),/*#__PURE__*/React.createElement(\"skinnedMesh\",{castShadow:true,receiveShadow:true,material:materials.glove,\"material-roughness\":1,geometry:nodes.arm.geometry,skeleton:nodes.arm.skeleton})),/*#__PURE__*/React.createElement(\"group\",{rotation:[0,-0.04,0],scale:[141.94,141.94,141.94]},/*#__PURE__*/React.createElement(\"mesh\",{castShadow:true,receiveShadow:true,material:materials.wood,geometry:nodes.mesh_0.geometry}),/*#__PURE__*/React.createElement(\"mesh\",{castShadow:true,receiveShadow:true,material:materials.side,geometry:nodes.mesh_1.geometry}),/*#__PURE__*/React.createElement(\"mesh\",{castShadow:true,receiveShadow:true,material:materials.foam,geometry:nodes.mesh_2.geometry}),/*#__PURE__*/React.createElement(\"mesh\",{castShadow:true,receiveShadow:true,material:materials.lower,geometry:nodes.mesh_3.geometry}),/*#__PURE__*/React.createElement(\"mesh\",{castShadow:true,receiveShadow:true,material:materials.upper,geometry:nodes.mesh_4.geometry}))));}function Ball(){// Load texture (the black plus sign)\nvar map=useLoader(THREE.TextureLoader,earthImg);// Make the ball a physics object with a low mass\nvar _useSphere=useSphere(function(){return{mass:1,args:0.5,position:[0,5,0]};}),_useSphere2=_slicedToArray(_useSphere,1),ref=_useSphere2[0];return/*#__PURE__*/React.createElement(\"mesh\",{castShadow:true,ref:ref},/*#__PURE__*/React.createElement(\"sphereBufferGeometry\",{attach:\"geometry\",args:[0.5,64,64]}),/*#__PURE__*/React.createElement(\"meshStandardMaterial\",{attach:\"material\",map:map}));}function ContactGround(){// When the ground was hit we reset the game ...\nvar _useStore2=useStore(function(state){return state.api;}),reset=_useStore2.reset;var _usePlane=usePlane(function(){return{type:\"Static\",rotation:[-Math.PI/2,0,0],position:[0,-10,0],onCollide:function onCollide(){return reset(true);}};}),_usePlane2=_slicedToArray(_usePlane,1),ref=_usePlane2[0];return/*#__PURE__*/React.createElement(\"mesh\",{ref:ref});}export default function(){var welcome=useStore(function(state){return state.welcome;});var _useStore3=useStore(function(state){return state.api;}),reset=_useStore3.reset;var onClick=useCallback(function(){return welcome&&reset(false);},[welcome,reset]);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Canvas,{shadowMap:true,sRGB:true,camera:{position:[0,5,12],fov:50},onClick:onClick},/*#__PURE__*/React.createElement(\"color\",{attach:\"background\",args:[\"#171720\"]}),/*#__PURE__*/React.createElement(\"ambientLight\",{intensity:0.5}),/*#__PURE__*/React.createElement(\"pointLight\",{position:[-10,-10,-10]}),/*#__PURE__*/React.createElement(\"spotLight\",{position:[10,10,10],angle:0.3,penumbra:1,intensity:1,castShadow:true,\"shadow-mapSize-width\":2048,\"shadow-mapSize-height\":2048,\"shadow-bias\":-0.0001}),/*#__PURE__*/React.createElement(Physics,{iterations:20,tolerance:0.0001,defaultContactMaterial:{friction:0.9,restitution:0.7,contactEquationStiffness:1e7,contactEquationRelaxation:1,frictionEquationStiffness:1e7,frictionEquationRelaxation:2},gravity:[0,-40,0],allowSleep:false},/*#__PURE__*/React.createElement(\"mesh\",{position:[0,0,-10],receiveShadow:true},/*#__PURE__*/React.createElement(\"planeBufferGeometry\",{attach:\"geometry\",args:[1000,1000]}),/*#__PURE__*/React.createElement(\"meshPhongMaterial\",{attach:\"material\",color:\"#172017\"})),/*#__PURE__*/React.createElement(ContactGround,null),!welcome&&/*#__PURE__*/React.createElement(Ball,null),/*#__PURE__*/React.createElement(Suspense,{fallback:null},/*#__PURE__*/React.createElement(Paddle,null)))),/*#__PURE__*/React.createElement(\"div\",{className:\"startup\",style:{display:welcome?\"block\":\"none\"}},\"* click to start ...\"));}","map":{"version":3,"sources":["D:/Facultate/AN3 SEM 2/EGIOC/ping-pong-r3f-usecannon-forked/src/App.js"],"names":["Canvas","useFrame","useLoader","Physics","useSphere","useBox","usePlane","create","THREE","GLTFLoader","React","Suspense","useRef","useCallback","lerp","clamp","Text","pingSound","earthImg","ping","Audio","set","count","welcome","api","pong","velocity","currentTime","volume","play","state","reset","useStore","Paddle","nodes","materials","model","type","args","onCollide","e","contact","impactVelocity","ref","values","current","mouse","x","Math","PI","position","y","rotation","toString","Bone","Bone003","Bone006","Bone010","glove","arm","geometry","skeleton","wood","mesh_0","side","mesh_1","foam","mesh_2","lower","mesh_3","upper","mesh_4","Ball","map","TextureLoader","mass","ContactGround","onClick","fov","friction","restitution","contactEquationStiffness","contactEquationRelaxation","frictionEquationStiffness","frictionEquationRelaxation","display"],"mappings":"2LAAA;AACA,OAASA,MAAT,CAAiBC,QAAjB,CAA2BC,SAA3B,KAA4C,mBAA5C,CACA;AACA,OAASC,OAAT,CAAkBC,SAAlB,CAA6BC,MAA7B,CAAqCC,QAArC,KAAqD,YAArD,CACA;AACA,MAAOC,CAAAA,MAAP,KAAmB,SAAnB,CAEA,MAAO,GAAKC,CAAAA,KAAZ,KAAuB,OAAvB,CACA,OAASC,UAAT,KAA2B,uCAA3B,CACA,MAAOC,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,MAA1B,CAAkCC,WAAlC,KAAqD,OAArD,CACA,MAAOC,CAAAA,IAAP,KAAiB,MAAjB,CACA,MAAOC,CAAAA,KAAP,KAAkB,iBAAlB,CACA,MAAOC,CAAAA,IAAP,KAAiB,QAAjB,CACA,MAAOC,CAAAA,SAAP,KAAsB,sBAAtB,CACA,MAAOC,CAAAA,QAAP,KAAqB,uBAArB,CAEA;AACA,GAAMC,CAAAA,IAAI,CAAG,GAAIC,CAAAA,KAAJ,CAAUH,SAAV,CAAb,C,YACmBV,MAAM,CAAC,SAACc,GAAD,QAAU,CAClCC,KAAK,CAAE,CAD2B,CAElCC,OAAO,CAAE,IAFyB,CAGlCC,GAAG,CAAE,CACHC,IADG,eACEC,QADF,CACY,CACbP,IAAI,CAACQ,WAAL,CAAmB,CAAnB,CACAR,IAAI,CAACS,MAAL,CAAcb,KAAK,CAACW,QAAQ,CAAG,EAAZ,CAAgB,CAAhB,CAAmB,CAAnB,CAAnB,CACAP,IAAI,CAACU,IAAL,GACA,GAAIH,QAAQ,CAAG,CAAf,CAAkBL,GAAG,CAAC,SAACS,KAAD,QAAY,CAAER,KAAK,CAAEQ,KAAK,CAACR,KAAN,CAAc,CAAvB,CAAZ,EAAD,CAAH,CACnB,CANE,CAOHS,KAAK,CAAE,eAACR,OAAD,QAAaF,CAAAA,GAAG,CAAC,SAACS,KAAD,QAAY,CAAEP,OAAO,CAAPA,OAAF,CAAWD,KAAK,CAAEC,OAAO,CAAGO,KAAK,CAACR,KAAT,CAAiB,CAA1C,CAAZ,EAAD,CAAhB,EAPJ,CAH6B,CAAV,EAAD,C,oCAAlBU,Q,aAcP;AACA,QAASC,CAAAA,MAAT,EAAkB,CAChB;AADgB,eAEa/B,SAAS,CAACO,UAAD,CAAa,eAAb,CAFtB,CAERyB,KAFQ,YAERA,KAFQ,CAEDC,SAFC,YAEDA,SAFC,CAGhB;AAHgB,cAICH,QAAQ,CAAC,SAACF,KAAD,QAAWA,CAAAA,KAAK,CAACN,GAAjB,EAAD,CAJT,CAIRC,IAJQ,WAIRA,IAJQ,CAKhB,GAAMF,CAAAA,OAAO,CAAGS,QAAQ,CAAC,SAACF,KAAD,QAAWA,CAAAA,KAAK,CAACP,OAAjB,EAAD,CAAxB,CACA,GAAMD,CAAAA,KAAK,CAAGU,QAAQ,CAAC,SAACF,KAAD,QAAWA,CAAAA,KAAK,CAACR,KAAjB,EAAD,CAAtB,CACA,GAAMc,CAAAA,KAAK,CAAGxB,MAAM,EAApB,CACA;AARgB,YASGP,MAAM,CAAC,iBAAO,CAAEgC,IAAI,CAAE,WAAR,CAAqBC,IAAI,CAAE,CAAC,GAAD,CAAM,CAAN,CAAS,GAAT,CAA3B,CAA0CC,SAAS,CAAE,mBAACC,CAAD,QAAOf,CAAAA,IAAI,CAACe,CAAC,CAACC,OAAF,CAAUC,cAAX,CAAX,EAArD,CAAP,EAAD,CATT,oCASTC,GATS,aASJnB,GATI,aAUhB;AACA,GAAIoB,CAAAA,MAAM,CAAGhC,MAAM,CAAC,CAAC,CAAD,CAAI,CAAJ,CAAD,CAAnB,CACAX,QAAQ,CAAC,SAAC6B,KAAD,CAAW,CAClB;AACAc,MAAM,CAACC,OAAP,CAAe,CAAf,EAAoB/B,IAAI,CAAC8B,MAAM,CAACC,OAAP,CAAe,CAAf,CAAD,CAAqBf,KAAK,CAACgB,KAAN,CAAYC,CAAZ,CAAgBC,IAAI,CAACC,EAAtB,CAA4B,CAAhD,CAAmD,GAAnD,CAAxB,CACAL,MAAM,CAACC,OAAP,CAAe,CAAf,EAAoB/B,IAAI,CAAC8B,MAAM,CAACC,OAAP,CAAe,CAAf,CAAD,CAAqBf,KAAK,CAACgB,KAAN,CAAYC,CAAZ,CAAgBC,IAAI,CAACC,EAAtB,CAA4B,CAAhD,CAAmD,GAAnD,CAAxB,CACAzB,GAAG,CAAC0B,QAAJ,CAAa7B,GAAb,CAAiBS,KAAK,CAACgB,KAAN,CAAYC,CAAZ,CAAgB,EAAjC,CAAqCjB,KAAK,CAACgB,KAAN,CAAYK,CAAZ,CAAgB,CAArD,CAAwD,CAAxD,EACA3B,GAAG,CAAC4B,QAAJ,CAAa/B,GAAb,CAAiB,CAAjB,CAAoB,CAApB,CAAuBuB,MAAM,CAACC,OAAP,CAAe,CAAf,CAAvB,EACA;AACAT,KAAK,CAACS,OAAN,CAAcO,QAAd,CAAuBL,CAAvB,CAA2BjC,IAAI,CAACsB,KAAK,CAACS,OAAN,CAAcO,QAAd,CAAuBL,CAAxB,CAA2BxB,OAAO,CAAGyB,IAAI,CAACC,EAAL,CAAU,CAAb,CAAiB,CAAnD,CAAsD,GAAtD,CAA/B,CACAb,KAAK,CAACS,OAAN,CAAcO,QAAd,CAAuBD,CAAvB,CAA2BP,MAAM,CAACC,OAAP,CAAe,CAAf,CAA3B,CACD,CATO,CAAR,CAUA,mBACE,4BAAM,GAAG,CAAEF,GAAX,CAAgB,OAAO,CAAE,IAAzB,eACE,6BAAO,GAAG,CAAEP,KAAZ,CAAmB,QAAQ,CAAE,CAAC,CAAC,IAAF,CAAQ,IAAR,CAAc,GAAd,CAA7B,CAAiD,KAAK,CAAE,CAAC,IAAD,CAAO,IAAP,CAAa,IAAb,CAAxD,eACE,oBAAC,IAAD,EAAM,QAAQ,CAAE,CAAC,CAACY,IAAI,CAACC,EAAN,CAAW,CAAZ,CAAe,CAAf,CAAkB,CAAlB,CAAhB,CAAsC,QAAQ,CAAE,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAAhD,CAA2D,IAAI,CAAE,CAAjE,CAAoE,QAAQ,CAAE3B,KAAK,CAAC+B,QAAN,EAA9E,EADF,cAEE,6BAAO,QAAQ,CAAE,CAAC,IAAD,CAAO,CAAC,IAAR,CAAc,IAAd,CAAjB,CAAsC,KAAK,CAAE,CAAC,IAAD,CAAO,IAAP,CAAa,IAAb,CAA7C,eACE,iCAAW,MAAM,CAAEnB,KAAK,CAACoB,IAAzB,EADF,cAEE,iCAAW,MAAM,CAAEpB,KAAK,CAACqB,OAAzB,EAFF,cAGE,iCAAW,MAAM,CAAErB,KAAK,CAACsB,OAAzB,EAHF,cAIE,iCAAW,MAAM,CAAEtB,KAAK,CAACuB,OAAzB,EAJF,cAKE,mCAAa,UAAU,KAAvB,CAAwB,aAAa,KAArC,CAAsC,QAAQ,CAAEtB,SAAS,CAACuB,KAA1D,CAAiE,qBAAoB,CAArF,CAAwF,QAAQ,CAAExB,KAAK,CAACyB,GAAN,CAAUC,QAA5G,CAAsH,QAAQ,CAAE1B,KAAK,CAACyB,GAAN,CAAUE,QAA1I,EALF,CAFF,cASE,6BAAO,QAAQ,CAAE,CAAC,CAAD,CAAI,CAAC,IAAL,CAAW,CAAX,CAAjB,CAAgC,KAAK,CAAE,CAAC,MAAD,CAAS,MAAT,CAAiB,MAAjB,CAAvC,eACE,4BAAM,UAAU,KAAhB,CAAiB,aAAa,KAA9B,CAA+B,QAAQ,CAAE1B,SAAS,CAAC2B,IAAnD,CAAyD,QAAQ,CAAE5B,KAAK,CAAC6B,MAAN,CAAaH,QAAhF,EADF,cAEE,4BAAM,UAAU,KAAhB,CAAiB,aAAa,KAA9B,CAA+B,QAAQ,CAAEzB,SAAS,CAAC6B,IAAnD,CAAyD,QAAQ,CAAE9B,KAAK,CAAC+B,MAAN,CAAaL,QAAhF,EAFF,cAGE,4BAAM,UAAU,KAAhB,CAAiB,aAAa,KAA9B,CAA+B,QAAQ,CAAEzB,SAAS,CAAC+B,IAAnD,CAAyD,QAAQ,CAAEhC,KAAK,CAACiC,MAAN,CAAaP,QAAhF,EAHF,cAIE,4BAAM,UAAU,KAAhB,CAAiB,aAAa,KAA9B,CAA+B,QAAQ,CAAEzB,SAAS,CAACiC,KAAnD,CAA0D,QAAQ,CAAElC,KAAK,CAACmC,MAAN,CAAaT,QAAjF,EAJF,cAKE,4BAAM,UAAU,KAAhB,CAAiB,aAAa,KAA9B,CAA+B,QAAQ,CAAEzB,SAAS,CAACmC,KAAnD,CAA0D,QAAQ,CAAEpC,KAAK,CAACqC,MAAN,CAAaX,QAAjF,EALF,CATF,CADF,CADF,CAqBD,CAED,QAASY,CAAAA,IAAT,EAAgB,CACd;AACA,GAAMC,CAAAA,GAAG,CAAGvE,SAAS,CAACM,KAAK,CAACkE,aAAP,CAAsBxD,QAAtB,CAArB,CACA;AAHc,eAIAd,SAAS,CAAC,iBAAO,CAAEuE,IAAI,CAAE,CAAR,CAAWrC,IAAI,CAAE,GAAjB,CAAsBY,QAAQ,CAAE,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAAhC,CAAP,EAAD,CAJT,0CAIPP,GAJO,gBAKd,mBACE,4BAAM,UAAU,KAAhB,CAAiB,GAAG,CAAEA,GAAtB,eACE,4CAAsB,MAAM,CAAC,UAA7B,CAAwC,IAAI,CAAE,CAAC,GAAD,CAAM,EAAN,CAAU,EAAV,CAA9C,EADF,cAEE,4CAAsB,MAAM,CAAC,UAA7B,CAAwC,GAAG,CAAE8B,GAA7C,EAFF,CADF,CAMD,CAED,QAASG,CAAAA,aAAT,EAAyB,CACvB;AADuB,eAEL5C,QAAQ,CAAC,SAACF,KAAD,QAAWA,CAAAA,KAAK,CAACN,GAAjB,EAAD,CAFH,CAEfO,KAFe,YAEfA,KAFe,eAGTzB,QAAQ,CAAC,iBAAO,CAAE+B,IAAI,CAAE,QAAR,CAAkBe,QAAQ,CAAE,CAAC,CAACJ,IAAI,CAACC,EAAN,CAAW,CAAZ,CAAe,CAAf,CAAkB,CAAlB,CAA5B,CAAkDC,QAAQ,CAAE,CAAC,CAAD,CAAI,CAAC,EAAL,CAAS,CAAT,CAA5D,CAAyEX,SAAS,CAAE,2BAAMR,CAAAA,KAAK,CAAC,IAAD,CAAX,EAApF,CAAP,EAAD,CAHC,wCAGhBY,GAHgB,eAIvB,mBAAO,4BAAM,GAAG,CAAEA,GAAX,EAAP,CACD,CAED,cAAe,WAAY,CACzB,GAAMpB,CAAAA,OAAO,CAAGS,QAAQ,CAAC,SAACF,KAAD,QAAWA,CAAAA,KAAK,CAACP,OAAjB,EAAD,CAAxB,CADyB,eAEPS,QAAQ,CAAC,SAACF,KAAD,QAAWA,CAAAA,KAAK,CAACN,GAAjB,EAAD,CAFD,CAEjBO,KAFiB,YAEjBA,KAFiB,CAGzB,GAAM8C,CAAAA,OAAO,CAAGhE,WAAW,CAAC,iBAAMU,CAAAA,OAAO,EAAIQ,KAAK,CAAC,KAAD,CAAtB,EAAD,CAAgC,CAACR,OAAD,CAAUQ,KAAV,CAAhC,CAA3B,CACA,mBACE,qDACE,oBAAC,MAAD,EAAQ,SAAS,KAAjB,CAAkB,IAAI,KAAtB,CAAuB,MAAM,CAAE,CAAEmB,QAAQ,CAAE,CAAC,CAAD,CAAI,CAAJ,CAAO,EAAP,CAAZ,CAAwB4B,GAAG,CAAE,EAA7B,CAA/B,CAAkE,OAAO,CAAED,OAA3E,eACE,6BAAO,MAAM,CAAC,YAAd,CAA2B,IAAI,CAAE,CAAC,SAAD,CAAjC,EADF,cAEE,oCAAc,SAAS,CAAE,GAAzB,EAFF,cAGE,kCAAY,QAAQ,CAAE,CAAC,CAAC,EAAF,CAAM,CAAC,EAAP,CAAW,CAAC,EAAZ,CAAtB,EAHF,cAIE,iCACE,QAAQ,CAAE,CAAC,EAAD,CAAK,EAAL,CAAS,EAAT,CADZ,CAEE,KAAK,CAAE,GAFT,CAGE,QAAQ,CAAE,CAHZ,CAIE,SAAS,CAAE,CAJb,CAKE,UAAU,KALZ,CAME,uBAAsB,IANxB,CAOE,wBAAuB,IAPzB,CAQE,cAAa,CAAC,MARhB,EAJF,cAcE,oBAAC,OAAD,EACE,UAAU,CAAE,EADd,CAEE,SAAS,CAAE,MAFb,CAGE,sBAAsB,CAAE,CACtBE,QAAQ,CAAE,GADY,CAEtBC,WAAW,CAAE,GAFS,CAGtBC,wBAAwB,CAAE,GAHJ,CAItBC,yBAAyB,CAAE,CAJL,CAKtBC,yBAAyB,CAAE,GALL,CAMtBC,0BAA0B,CAAE,CANN,CAH1B,CAWE,OAAO,CAAE,CAAC,CAAD,CAAI,CAAC,EAAL,CAAS,CAAT,CAXX,CAYE,UAAU,CAAE,KAZd,eAaE,4BAAM,QAAQ,CAAE,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAC,EAAR,CAAhB,CAA6B,aAAa,KAA1C,eACE,2CAAqB,MAAM,CAAC,UAA5B,CAAuC,IAAI,CAAE,CAAC,IAAD,CAAO,IAAP,CAA7C,EADF,cAEE,yCAAmB,MAAM,CAAC,UAA1B,CAAqC,KAAK,CAAC,SAA3C,EAFF,CAbF,cAiBE,oBAAC,aAAD,MAjBF,CAkBG,CAAC7D,OAAD,eAAY,oBAAC,IAAD,MAlBf,cAmBE,oBAAC,QAAD,EAAU,QAAQ,CAAE,IAApB,eACE,oBAAC,MAAD,MADF,CAnBF,CAdF,CADF,cAuCE,2BAAK,SAAS,CAAC,SAAf,CAAyB,KAAK,CAAE,CAAE8D,OAAO,CAAE9D,OAAO,CAAG,OAAH,CAAa,MAA/B,CAAhC,yBAvCF,CADF,CA6CD","sourcesContent":["// react-three-fiber is a way to express threejs declaratively: https://github.com/react-spring/react-three-fiber\nimport { Canvas, useFrame, useLoader } from \"react-three-fiber\"\n// use-cannon is a hook around the cannon.js physics library: https://github.com/react-spring/use-cannon\nimport { Physics, useSphere, useBox, usePlane } from \"use-cannon\"\n// zustand is a minimal state-manager: https://github.com/react-spring/zustand\nimport create from \"zustand\"\n\nimport * as THREE from \"three\"\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\"\nimport React, { Suspense, useRef, useCallback } from \"react\"\nimport lerp from \"lerp\"\nimport clamp from \"lodash-es/clamp\"\nimport Text from \"./Text\"\nimport pingSound from \"./resources/ping.mp3\"\nimport earthImg from \"./resources/cross.jpg\"\n\n// Create a store ...\nconst ping = new Audio(pingSound)\nconst [useStore] = create((set) => ({\n  count: 0,\n  welcome: true,\n  api: {\n    pong(velocity) {\n      ping.currentTime = 0\n      ping.volume = clamp(velocity / 20, 0, 1)\n      ping.play()\n      if (velocity > 4) set((state) => ({ count: state.count + 1 }))\n    },\n    reset: (welcome) => set((state) => ({ welcome, count: welcome ? state.count : 0 })),\n  },\n}))\n\n// The paddle was made in blender and auto-converted to JSX by https://github.com/react-spring/gltfjsx\nfunction Paddle() {\n  // Load the gltf file\n  const { nodes, materials } = useLoader(GLTFLoader, \"/pingpong.glb\")\n  // Fetch some reactive state\n  const { pong } = useStore((state) => state.api)\n  const welcome = useStore((state) => state.welcome)\n  const count = useStore((state) => state.count)\n  const model = useRef()\n  // Make it a physical object that adheres to gravitation and impact\n  const [ref, api] = useBox(() => ({ type: \"Kinematic\", args: [3.4, 1, 3.5], onCollide: (e) => pong(e.contact.impactVelocity) }))\n  // use-frame allows the component to subscribe to the render-loop for frame-based actions\n  let values = useRef([0, 0])\n  useFrame((state) => {\n    // The paddle is kinematic (not subject to gravitation), we move it with the api returned by useBox\n    values.current[0] = lerp(values.current[0], (state.mouse.x * Math.PI) / 5, 0.2)\n    values.current[1] = lerp(values.current[1], (state.mouse.x * Math.PI) / 5, 0.2)\n    api.position.set(state.mouse.x * 10, state.mouse.y * 5, 0)\n    api.rotation.set(0, 0, values.current[1])\n    // Left/right mouse movement rotates it a liitle for effect only\n    model.current.rotation.x = lerp(model.current.rotation.x, welcome ? Math.PI / 2 : 0, 0.2)\n    model.current.rotation.y = values.current[0]\n  })\n  return (\n    <mesh ref={ref} dispose={null}>\n      <group ref={model} position={[-0.05, 0.37, 0.3]} scale={[0.15, 0.15, 0.15]}>\n        <Text rotation={[-Math.PI / 2, 0, 0]} position={[0, 1, 2]} size={1} children={count.toString()} />\n        <group rotation={[1.88, -0.35, 2.32]} scale={[2.97, 2.97, 2.97]}>\n          <primitive object={nodes.Bone} />\n          <primitive object={nodes.Bone003} />\n          <primitive object={nodes.Bone006} />\n          <primitive object={nodes.Bone010} />\n          <skinnedMesh castShadow receiveShadow material={materials.glove} material-roughness={1} geometry={nodes.arm.geometry} skeleton={nodes.arm.skeleton} />\n        </group>\n        <group rotation={[0, -0.04, 0]} scale={[141.94, 141.94, 141.94]}>\n          <mesh castShadow receiveShadow material={materials.wood} geometry={nodes.mesh_0.geometry} />\n          <mesh castShadow receiveShadow material={materials.side} geometry={nodes.mesh_1.geometry} />\n          <mesh castShadow receiveShadow material={materials.foam} geometry={nodes.mesh_2.geometry} />\n          <mesh castShadow receiveShadow material={materials.lower} geometry={nodes.mesh_3.geometry} />\n          <mesh castShadow receiveShadow material={materials.upper} geometry={nodes.mesh_4.geometry} />\n        </group>\n      </group>\n    </mesh>\n  )\n}\n\nfunction Ball() {\n  // Load texture (the black plus sign)\n  const map = useLoader(THREE.TextureLoader, earthImg)\n  // Make the ball a physics object with a low mass\n  const [ref] = useSphere(() => ({ mass: 1, args: 0.5, position: [0, 5, 0] }))\n  return (\n    <mesh castShadow ref={ref}>\n      <sphereBufferGeometry attach=\"geometry\" args={[0.5, 64, 64]} />\n      <meshStandardMaterial attach=\"material\" map={map} />\n    </mesh>\n  )\n}\n\nfunction ContactGround() {\n  // When the ground was hit we reset the game ...\n  const { reset } = useStore((state) => state.api)\n  const [ref] = usePlane(() => ({ type: \"Static\", rotation: [-Math.PI / 2, 0, 0], position: [0, -10, 0], onCollide: () => reset(true) }))\n  return <mesh ref={ref} />\n}\n\nexport default function () {\n  const welcome = useStore((state) => state.welcome)\n  const { reset } = useStore((state) => state.api)\n  const onClick = useCallback(() => welcome && reset(false), [welcome, reset])\n  return (\n    <>\n      <Canvas shadowMap sRGB camera={{ position: [0, 5, 12], fov: 50 }} onClick={onClick}>\n        <color attach=\"background\" args={[\"#171720\"]} />\n        <ambientLight intensity={0.5} />\n        <pointLight position={[-10, -10, -10]} />\n        <spotLight\n          position={[10, 10, 10]}\n          angle={0.3}\n          penumbra={1}\n          intensity={1}\n          castShadow\n          shadow-mapSize-width={2048}\n          shadow-mapSize-height={2048}\n          shadow-bias={-0.0001}\n        />\n        <Physics\n          iterations={20}\n          tolerance={0.0001}\n          defaultContactMaterial={{\n            friction: 0.9,\n            restitution: 0.7,\n            contactEquationStiffness: 1e7,\n            contactEquationRelaxation: 1,\n            frictionEquationStiffness: 1e7,\n            frictionEquationRelaxation: 2,\n          }}\n          gravity={[0, -40, 0]}\n          allowSleep={false}>\n          <mesh position={[0, 0, -10]} receiveShadow>\n            <planeBufferGeometry attach=\"geometry\" args={[1000, 1000]} />\n            <meshPhongMaterial attach=\"material\" color=\"#172017\" />\n          </mesh>\n          <ContactGround />\n          {!welcome && <Ball />}\n          <Suspense fallback={null}>\n            <Paddle />\n          </Suspense>\n        </Physics>\n      </Canvas>\n      <div className=\"startup\" style={{ display: welcome ? \"block\" : \"none\" }}>\n        * click to start ...\n      </div>\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}